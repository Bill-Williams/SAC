@model SAC.Domain.Models.Club

@{
    ViewBag.Title = "Directions";

    var isIos = false;

    var userAgent = HttpContext.Current.Request.UserAgent.ToLower();
    if (userAgent.Contains("iphone;")
        || userAgent.Contains("ipad;"))
    {
        isIos = true;
    }
}

<h2>@Model.Name</h2>

<div class="row">
    <div id="myMap" style='position:relative;width:100%;height:400px;'></div>
</div>

<h3>
    @if (isIos)
    {
        <a href="http://maps.apple.com/maps?q=@Model.Address+@Model.CityStateZip">@Model.Address<br />@Model.CityStateZip</a>
    }
    else
    {
        <a href="http://maps.google.com/maps?q=@Model.Address+@Model.CityStateZip">@Model.Address<br />@Model.CityStateZip</a>
    }

</h3>

@section Scripts {
    <script type='text/javascript' src='https://www.bing.com/api/maps/mapcontrol?callback=GetDirections' async defer></script>
    
    <script>
        function GetDirections()
        {
            var map = new Microsoft.Maps.Map('#myMap', {
                credentials: "@System.Environment.GetEnvironmentVariable("sac-bing-maps")"
            });

            Microsoft.Maps.loadModule('Microsoft.Maps.Search', function () {
                var searchManager = new Microsoft.Maps.Search.SearchManager(map);
                var requestOptions = {
                    where: '@Model.Address,@Model.CityStateZip',
                    callback: function (answer, userData) {
                        map.setView({ bounds: answer.results[0].bestView });
                        map.entities.push(new Microsoft.Maps.Pushpin(answer.results[0].location));
                        }
                    };
                searchManager.geocode(requestOptions);
            });

        };
    </script>
}